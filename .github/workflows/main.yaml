name: docker-image-push

on:
    push:
         branches:
            - main
permissions:
    id-token: write
    contents: read

env:
    login-server: icicihelmreg.azurecr.io 
    username: icicihelmreg
    password: yPfDLmKHmjWu5IXK883sgMny9g+ZWIV/68Iy4uZ1Gv+ACRA6En5Z
jobs:

    acrjob:
         runs-on: ubuntu-latest
         steps:
            - name: checkout the code
              uses: actions/checkout@v3
              #log into azure
            - name: azure credentials
              uses: azure/login@v1
              with:
                    creds: ${{ secrets.AZURE_CREDS }}
                    
            - name: docker credentials
              uses: azure/docker-login@v1
              with:
                    login-server: ${{env.login-server}}
                    username: ${{env.username}}
                    password: ${{env.password}}
            - name: building and psuhing image
              run:  |
                  docker build -t icicihelmreg.azurecr.io/icicihelmreg/nodejsproject:1.0.0 .
                  docker images
                  docker push icicihelmreg.azurecr.io/icicihelmreg/nodejsproject:1.0.0
                  
            